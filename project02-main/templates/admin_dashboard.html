<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - E-Class Record</title>
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin-dashboard.css') }}">
</head>

<body>
    <div class="header">
        <div>
            <h1>‚ö° Admin Dashboard</h1>
            <p>Welcome, Admin {{ user.school_id }}!</p>
        </div>
        <div class="header-actions">
            <button onclick="createInstructor()" class="action-btn">üë®‚Äçüè´ Create Instructor</button>
            <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
        </div>
    </div>

    <div class="dashboard-grid">
        <div class="card">
            <h3>üë• User Management</h3>
            <p>Manage all users, students, and instructors.</p>
            <button onclick="createInstructor()" class="action-btn" style="margin-top: 15px;">üë®‚Äçüè´ Create
                Instructor</button>
        </div>

        <div class="card" id="instructorsCard">
            <h3>üë®‚Äçüè´ Added Instructors</h3>
            <div id="instructorsAnalytics">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #dc2626;" id="totalInstructors">0</div>
                        <div style="color: #6b7280;">Total Instructors</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #059669;" id="activeInstructors">0</div>
                        <div style="color: #6b7280;">Active</div>
                    </div>
                    <div>
                        <div style="font-size: 24px; font-weight: bold; color: #dc2626;" id="suspendedInstructors">0</div>
                        <div style="color: #6b7280;">Suspended</div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; color: #374151; font-size: 14px;">Recently Added</h4>
                    <div id="recentInstructors">
                        <p style="color: #6b7280; font-style: italic;">No instructors yet</p>
                    </div>
                </div>
                <button onclick="viewAllInstructors()" class="action-btn" style="width: 100%;">üëÅÔ∏è View All Instructors</button>
            </div>
        </div>

        <div class="card">
            <h3>‚öôÔ∏è System Settings</h3>
            <p>Configure system preferences and settings.</p>
            <p><em>Feature coming soon...</em></p>
        </div>

        <div class="card">
            <h3>üìã Audit Logs</h3>
            <p>Monitor system activity and security logs.</p>
            <p><em>Feature coming soon...</em></p>
        </div>

      
    </div>

    <!-- CSRF Token for JavaScript -->
    <script>
        const csrfToken = "{{ csrf_token() }}";
    </script>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.all.min.js"></script>

    <script>
        // Clean SweetAlert2 implementation - no random Swal calls
        function createInstructor() {
            Swal.fire({
                title: 'Create New Instructor',
                html: `
                    <div style="padding: 10px 0;">
                        <div style="display: flex; flex-direction: column; gap: 15px; max-height: 500px; overflow-y: auto;">

                            <!-- Personal Information Section -->
                            <div style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                <h4 style="margin: 0 0 15px 0; color: #1f2937; font-size: 16px;">üìã Personal Information</h4>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">First Name *</label>
                                        <input type="text" id="firstName" placeholder="e.g. John" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Last Name *</label>
                                        <input type="text" id="lastName" placeholder="e.g. Doe" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>
                                </div>

                                <div style="margin-top: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Middle Name</label>
                                    <input type="text" id="middleName" placeholder="e.g. Smith" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Email *</label>
                                        <input type="email" id="email" placeholder="e.g. john.doe@university.edu" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Phone</label>
                                        <input type="tel" id="phone" placeholder="e.g. +63 912 345 6789" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>
                                </div>

                                <div style="margin-top: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Address</label>
                                    <input type="text" id="address" placeholder="Complete address" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Birth Date</label>
                                        <input type="date" id="birthDate" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Gender</label>
                                        <select id="gender" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box; background: white;">
                                            <option value="">Select Gender</option>
                                            <option value="Male">Male</option>
                                            <option value="Female">Female</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Emergency Contact</label>
                                        <input type="text" id="emergencyContactName" placeholder="Contact person name" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>

                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Contact Phone</label>
                                        <input type="tel" id="emergencyContactPhone" placeholder="Emergency contact number" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                    </div>
                                </div>
                            </div>

                            <!-- Account Information Section -->
                            <div style="background: #fef3c7; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                                <h4 style="margin: 0 0 15px 0; color: #92400e; font-size: 16px;">üîê Account Information</h4>

                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">School ID *</label>
                                    <input type="text" id="schoolId" placeholder="e.g. INST001" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>

                                <div style="margin-top: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Employee ID</label>
                                    <input type="text" id="employeeId" placeholder="e.g. EMP001" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>

                                <div style="margin-top: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Password *</label>
                                    <input type="password" id="password" placeholder="Enter password" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>

                                <div style="margin-top: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Confirm Password *</label>
                                    <input type="password" id="confirmPassword" placeholder="Confirm password" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>
                            </div>

                            <!-- Professional Information Section -->
                            <div style="background: #dbeafe; padding: 15px; border-radius: 8px;">
                                <h4 style="margin: 0 0 15px 0; color: #1e40af; font-size: 16px;">üéì Professional Information</h4>

                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Department *</label>
                                    <select id="department" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box; background: white;">
                                        <option value="">Select Department</option>
                                        <option value="Computer Science">Computer Science</option>
                                        <option value="Information Technology">Information Technology</option>
                                        <option value="Mathematics">Mathematics</option>
                                        <option value="English">English</option>
                                        <option value="Science">Science</option>
                                        <option value="Business">Business</option>
                                        <option value="Engineering">Engineering</option>
                                    </select>
                                </div>

                                <div style="margin-top: 10px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Specialization</label>
                                    <input type="text" id="specialization" placeholder="e.g. Web Development" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 5px; font-size: 14px; box-sizing: border-box;">
                                </div>
                            </div>

                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Create Instructor',
                cancelButtonText: 'Cancel',
                confirmButtonColor: '#4F46E5',
                cancelButtonColor: '#6B7280',
                width: 450,
                padding: '20px',
                background: '#ffffff',
                preConfirm: () => {
                    // Personal Information
                    const firstName = document.getElementById('firstName').value.trim();
                    const lastName = document.getElementById('lastName').value.trim();
                    const middleName = document.getElementById('middleName').value.trim();
                    const email = document.getElementById('email').value.trim();
                    const phone = document.getElementById('phone').value.trim();
                    const address = document.getElementById('address').value.trim();
                    const birthDate = document.getElementById('birthDate').value;
                    const gender = document.getElementById('gender').value;
                    const emergencyContactName = document.getElementById('emergencyContactName').value.trim();
                    const emergencyContactPhone = document.getElementById('emergencyContactPhone').value.trim();

                    // Account Information
                    const schoolId = document.getElementById('schoolId').value.trim();
                    const password = document.getElementById('password').value;
                    const confirmPassword = document.getElementById('confirmPassword').value;
                    const employeeId = document.getElementById('employeeId').value.trim();

                    // Professional Information
                    const department = document.getElementById('department').value;
                    const specialization = document.getElementById('specialization').value.trim();

                    // Validation
                    const errors = [];

                    // Required field validations
                    if (!firstName) errors.push('First name is required');
                    if (!lastName) errors.push('Last name is required');
                    if (!email) errors.push('Email is required');
                    if (!schoolId) errors.push('School ID is required');
                    if (!password) errors.push('Password is required');
                    if (!department) errors.push('Department is required');

                    // Password validation
                    if (password !== confirmPassword) {
                        errors.push('Passwords do not match');
                    }
                    if (password.length < 6) {
                        errors.push('Password must be at least 6 characters long');
                    }

                    // Email validation
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (email && !emailRegex.test(email)) {
                        errors.push('Please enter a valid email address');
                    }

                    // Phone validation (if provided)
                    if (phone && !/^[\+]?[0-9\s\-\(\)]{10,}$/.test(phone)) {
                        errors.push('Please enter a valid phone number');
                    }

                    if (errors.length > 0) {
                        Swal.showValidationMessage(errors.join('; '));
                        return false;
                    }

                    return {
                        // Personal Information
                        firstName,
                        lastName,
                        middleName,
                        email,
                        phone,
                        address,
                        birthDate,
                        gender,
                        emergencyContactName,
                        emergencyContactPhone,
                        // Account Information
                        schoolId,
                        password,
                        employeeId,
                        // Professional Information
                        department,
                        specialization
                    };
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = result.value;

                    // Show loading
                    Swal.fire({
                        title: 'Creating Instructor...',
                        text: 'Please wait...',
                        allowOutsideClick: false,
                        showConfirmButton: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    // Send to server
                    fetch('/admin/create-instructor', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify(data)
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                Swal.fire({
                                    icon: 'success',
                                    title: 'Success!',
                                    text: 'Instructor created successfully!',
                                    timer: 2000,
                                    showConfirmButton: false
                                });
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error!',
                                    text: data.message || 'Failed to create instructor'
                                });
                            }
                        })
                        .catch(error => {
                            Swal.fire({
                                icon: 'error',
                                title: 'Error!',
                                text: 'Network error occurred'
                            });
                        });
                }
            });
        }

        // Enhanced welcome message with animations
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(() => {
                Swal.fire({
                    icon: 'success',
                    title: 'üî• Welcome, Admin!',
                    text: 'Your powerful admin dashboard is ready',
                    timer: 2500,
                    timerProgressBar: true,
                    showConfirmButton: false,
                    position: 'top-end',
                    toast: true,
                    background: '#fef2f2',
                    color: '#991b1b',
                    iconColor: '#dc2626',
                    customClass: {
                        popup: 'animate__animated animate__fadeInRight'
                    }
                });
            }, 1000); // Delay to let page animations complete
        });

        // ==========================================
        // INSTRUCTOR MANAGEMENT SYSTEM
        // ==========================================

        let instructorsData = [];
        let currentInstructorId = null;
        let pendingAction = null;

        // Load instructor analytics on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadInstructorAnalytics();
        });

        function loadInstructorAnalytics() {
            console.log('Loading instructor analytics...');
            fetch('/api/admin/instructors')
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Received data:', data);
                    if (data.success) {
                        displayInstructorAnalytics(data.analytics);
                        instructorsData = data.instructors;
                        displayInstructorsTable(data.instructors);
                    } else {
                        console.error('Failed to load instructor analytics:', data.error);
                        showNotification('Failed to load instructor data: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    console.error('Error loading instructor analytics:', error);
                    showNotification('Error loading instructor data: ' + error.message, 'error');
                });
        }

        function displayInstructorAnalytics(analytics) {
            document.getElementById('totalInstructors').textContent = analytics.total_instructors;
            document.getElementById('activeInstructors').textContent = analytics.active_instructors;
            document.getElementById('suspendedInstructors').textContent = analytics.suspended_instructors;

            const recentContainer = document.getElementById('recentInstructors');
            if (analytics.recent_instructors.length > 0) {
                recentContainer.innerHTML = analytics.recent_instructors.map(instructor => `
                    <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e5e7eb;">
                        <span>${instructor.name}</span>
                        <span style="color: #6b7280; font-size: 12px;">${new Date(instructor.created_at).toLocaleDateString()}</span>
                    </div>
                `).join('');
            } else {
                recentContainer.innerHTML = '<p style="color: #6b7280; font-style: italic;">No instructors yet</p>';
            }
        }

        function viewAllInstructors() {
            document.getElementById('instructorsModal').style.display = 'block';
            if (instructorsData.length === 0) {
                loadInstructorAnalytics(); // Reload if no data
            }
        }

        function closeInstructorsModal() {
            document.getElementById('instructorsModal').style.display = 'none';
            // Reset filters
            document.getElementById('searchName').value = '';
            document.getElementById('filterDepartment').value = '';
            document.getElementById('filterStatus').value = '';
        }

        function displayInstructorsTable(instructors) {
            const tbody = document.getElementById('instructorsTableBody');

            if (instructors.length === 0) {
                document.getElementById('noInstructors').style.display = 'block';
                tbody.innerHTML = '';
                return;
            }

            document.getElementById('noInstructors').style.display = 'none';

            tbody.innerHTML = instructors.map(instructor => `
                <tr>
                    <td>${instructor.id}</td>
                    <td>
                        <div>
                            <strong>${instructor.name}</strong><br>
                            <small style="color: #6b7280;">${instructor.school_id}</small>
                        </div>
                    </td>
                    <td>${instructor.department}</td>
                    <td>
                        <span class="status-badge status-${instructor.status}">
                            ${instructor.status}
                        </span>
                    </td>
                    <td>${instructor.created_at ? new Date(instructor.created_at).toLocaleDateString() : 'N/A'}</td>
                    <td style="text-align: center;">
                        <button onclick="viewInstructorDetails(${instructor.id})" class="action-btn-small btn-view" title="View Details">üëÅÔ∏è</button>
                        ${instructor.status === 'active'
                            ? `<button onclick="confirmAction('suspend', ${instructor.id}, '${instructor.name}')" class="action-btn-small btn-suspend" title="Suspend">‚è∏Ô∏è</button>`
                            : `<button onclick="confirmAction('unsuspend', ${instructor.id}, '${instructor.name}')" class="action-btn-small btn-unsuspend" title="Unsuspend">‚ñ∂Ô∏è</button>`
                        }
                        <button onclick="confirmAction('delete', ${instructor.id}, '${instructor.name}')" class="action-btn-small btn-delete" title="Delete">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterInstructors() {
            const searchName = document.getElementById('searchName').value.toLowerCase();
            const filterDepartment = document.getElementById('filterDepartment').value;
            const filterStatus = document.getElementById('filterStatus').value;

            const filteredInstructors = instructorsData.filter(instructor => {
                const matchesName = instructor.name.toLowerCase().includes(searchName);
                const matchesDepartment = !filterDepartment || instructor.department === filterDepartment;
                const matchesStatus = !filterStatus || instructor.status === filterStatus;

                return matchesName && matchesDepartment && matchesStatus;
            });

            displayInstructorsTable(filteredInstructors);
        }

        function sortTable(column) {
            // Simple sorting implementation
            instructorsData.sort((a, b) => {
                if (a[column] < b[column]) return -1;
                if (a[column] > b[column]) return 1;
                return 0;
            });
            displayInstructorsTable(instructorsData);
        }

        function viewInstructorDetails(instructorId) {
            closeInstructorsModal();
            currentInstructorId = instructorId;

            // Show loading state
            document.getElementById('instructorDetailsContent').innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <p>Loading instructor details...</p>
                </div>
            `;

            document.getElementById('instructorDetailsModal').style.display = 'block';

            // Fetch instructor details
            fetch(`/api/admin/instructors/${instructorId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayInstructorDetails(data.instructor);
                    } else {
                        document.getElementById('instructorDetailsContent').innerHTML = `
                            <div style="text-align: center; padding: 20px; color: #dc2626;">
                                <p>‚ùå Failed to load instructor details</p>
                                <p>${data.error}</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error loading instructor details:', error);
                    document.getElementById('instructorDetailsContent').innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #dc2626;">
                            <p>‚ùå Error loading instructor details</p>
                        </div>
                    `;
                });
        }

        function displayInstructorDetails(instructor) {
            const content = document.getElementById('instructorDetailsContent');

            content.innerHTML = `
                <!-- Personal Information Section -->
                <div class="details-section">
                    <h4>üë§ Personal Information</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Full Name</div>
                            <div class="detail-value">${instructor.personal_info.first_name} ${instructor.personal_info.middle_name || ''} ${instructor.personal_info.last_name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">${instructor.personal_info.email}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone</div>
                            <div class="detail-value">${instructor.personal_info.phone || 'Not provided'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Gender</div>
                            <div class="detail-value">${instructor.personal_info.gender || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Birth Date</div>
                            <div class="detail-value">${instructor.personal_info.birth_date ? new Date(instructor.personal_info.birth_date).toLocaleDateString() : 'Not provided'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Address</div>
                            <div class="detail-value">${instructor.personal_info.address || 'Not provided'}</div>
                        </div>
                    </div>

                    <!-- Emergency Contact -->
                    <h5 style="margin: 15px 0 10px 0; color: #6b7280;">Emergency Contact</h5>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Contact Name</div>
                            <div class="detail-value">${instructor.personal_info.emergency_contact_name || 'Not provided'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Contact Phone</div>
                            <div class="detail-value">${instructor.personal_info.emergency_contact_phone || 'Not provided'}</div>
                        </div>
                    </div>
                </div>

                <!-- Professional Information Section -->
                <div class="details-section">
                    <h4>üéì Professional Information</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Department</div>
                            <div class="detail-value">${instructor.professional_info.department || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Specialization</div>
                            <div class="detail-value">${instructor.professional_info.specialization || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Employee ID</div>
                            <div class="detail-value">${instructor.professional_info.employee_id || 'Not specified'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Hire Date</div>
                            <div class="detail-value">${instructor.professional_info.hire_date ? new Date(instructor.professional_info.hire_date).toLocaleDateString() : 'Not specified'}</div>
                        </div>
                    </div>
                </div>

                <!-- Account Information Section -->
                <div class="details-section">
                    <h4>üîê Account Information</h4>
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">School ID</div>
                            <div class="detail-value">${instructor.school_id}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value">
                                <span class="status-badge status-${instructor.account_info.status}">
                                    ${instructor.account_info.status}
                                </span>
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Account Created</div>
                            <div class="detail-value">${new Date(instructor.account_info.created_at).toLocaleDateString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Last Updated</div>
                            <div class="detail-value">${instructor.account_info.updated_at ? new Date(instructor.account_info.updated_at).toLocaleDateString() : 'Never'}</div>
                        </div>
                    </div>
                </div>

                <!-- Statistics Section -->
                <div class="details-section">
                    <h4>üìä Statistics & Classes</h4>
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-number">${instructor.statistics.total_classes}</div>
                            <div class="stat-label">Total Classes</div>
                        </div>
                    </div>

                    ${instructor.statistics.total_classes > 0 ? `
                        <div style="margin-top: 15px;">
                            <h5 style="margin: 0 0 10px 0; color: #6b7280;">Active Classes</h5>
                            <div style="max-height: 200px; overflow-y: auto;">
                                ${instructor.statistics.class_list.map(cls => `
                                    <div style="padding: 8px; background: white; margin-bottom: 5px; border-radius: 5px; border: 1px solid #e5e7eb;">
                                        <strong>${cls.class_id}</strong> - ${cls.course} ${cls.section}<br>
                                        <small style="color: #6b7280;">${cls.year} ${cls.semester} ‚Ä¢ Schedule: ${cls.schedule}</small>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : '<p style="color: #6b7280; font-style: italic;">No classes assigned yet</p>'}
                </div>

                <!-- Action Buttons -->
                <div style="text-align: right; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                    ${instructor.account_info.status === 'active'
                        ? `<button onclick="confirmAction('suspend', ${instructor.id}, '${instructor.personal_info.first_name} ${instructor.personal_info.last_name}')" class="action-btn-small btn-suspend">‚è∏Ô∏è Suspend Account</button>`
                        : `<button onclick="confirmAction('unsuspend', ${instructor.id}, '${instructor.personal_info.first_name} ${instructor.personal_info.last_name}')" class="action-btn-small btn-unsuspend">‚ñ∂Ô∏è Unsuspend Account</button>`
                    }
                    <button onclick="confirmAction('delete', ${instructor.id}, '${instructor.personal_info.first_name} ${instructor.personal_info.last_name}')" class="action-btn-small btn-delete">üóëÔ∏è Delete Account</button>
                </div>
            `;
        }

        function closeInstructorDetailsModal() {
            document.getElementById('instructorDetailsModal').style.display = 'none';
            currentInstructorId = null;
        }

        function confirmAction(action, instructorId, instructorName) {
            currentInstructorId = instructorId;
            pendingAction = action;

            const actionMessages = {
                'suspend': {
                    title: '‚ö†Ô∏è Suspend Instructor',
                    message: `Are you sure you want to suspend "${instructorName}"? This will restrict their access to all system features.`,
                    buttonText: 'Suspend'
                },
                'unsuspend': {
                    title: '‚úÖ Unsuspend Instructor',
                    message: `Are you sure you want to unsuspend "${instructorName}"? This will restore their access to all system features.`,
                    buttonText: 'Unsuspend'
                },
                'delete': {
                    title: 'üóëÔ∏è Delete Instructor',
                    message: `Are you sure you want to permanently delete "${instructorName}"? This action cannot be undone and will remove all associated data.`,
                    buttonText: 'Delete'
                }
            };

            const config = actionMessages[action];
            document.getElementById('confirmationTitle').innerHTML = config.title;
            document.getElementById('confirmationMessage').textContent = config.message;
            document.getElementById('confirmActionBtn').textContent = config.buttonText;
            document.getElementById('confirmActionBtn').style.backgroundColor =
                action === 'delete' ? '#dc2626' : '#f59e0b';

            document.getElementById('confirmationModal').style.display = 'block';
        }

        function closeConfirmationModal() {
            document.getElementById('confirmationModal').style.display = 'none';
            currentInstructorId = null;
            pendingAction = null;
        }

        function executeConfirmedAction() {
            if (!currentInstructorId || !pendingAction) return;

            console.log(`Executing action: ${pendingAction} on instructor ${currentInstructorId}`);

            switch (pendingAction) {
                case 'suspend':
                case 'unsuspend':
                    updateInstructorStatus(currentInstructorId, pendingAction);
                    break;
                case 'delete':
                    deleteInstructor(currentInstructorId);
                    break;
            }

            closeConfirmationModal();
        }

        function updateInstructorStatus(instructorId, action) {
            const newStatus = action === 'suspend' ? 'suspended' : 'active';
            console.log(`Updating instructor ${instructorId} status to ${newStatus}`);

            fetch(`/api/admin/instructors/${instructorId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({ status: newStatus })
            })
            .then(response => {
                console.log('Update status response:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Update status data:', data);
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadInstructorAnalytics(); // Refresh data

                    // If details modal is open, refresh it
                    if (document.getElementById('instructorDetailsModal').style.display !== 'none') {
                        viewInstructorDetails(instructorId);
                    }
                } else {
                    showNotification(data.error || 'Failed to update instructor status', 'error');
                }
            })
            .catch(error => {
                console.error('Error updating instructor status:', error);
                showNotification('Error updating instructor status: ' + error.message, 'error');
            });
        }

        function deleteInstructor(instructorId) {
            console.log(`Deleting instructor ${instructorId}`);

            fetch(`/api/admin/instructors/${instructorId}`, {
                method: 'DELETE',
                headers: {
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => {
                console.log('Delete response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Delete response data:', data);
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadInstructorAnalytics(); // Refresh data
                    closeInstructorDetailsModal(); // Close details modal if open
                } else {
                    showNotification(data.error || 'Failed to delete instructor', 'error');
                }
            })
            .catch(error => {
                console.error('Error deleting instructor:', error);
                showNotification('Error deleting instructor: ' + error.message, 'error');
            });
        }

        function showNotification(message, type) {
            // Create notification element
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 2000;
                animation: slideInRight 0.3s ease-out;
                ${type === 'success'
                    ? 'background: linear-gradient(135deg, #059669, #10b981);'
                    : 'background: linear-gradient(135deg, #dc2626, #ef4444);'
                }
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Remove notification after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 4000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const instructorsModal = document.getElementById('instructorsModal');
            const detailsModal = document.getElementById('instructorDetailsModal');
            const confirmationModal = document.getElementById('confirmationModal');

            if (event.target === instructorsModal) {
                closeInstructorsModal();
            }
            if (event.target === detailsModal) {
                closeInstructorDetailsModal();
            }
            if (event.target === confirmationModal) {
                closeConfirmationModal();
            }
        }
    </script>

    <!-- Instructor Management Modals -->
    <!-- Instructor List Modal -->
    <div id="instructorsModal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 90%; max-width: 1200px; max-height: 80vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>üë®‚Äçüè´ Instructor Management</h3>
                <span class="close" onclick="closeInstructorsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <!-- Search and Filter Controls -->
                <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 8px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; align-items: end;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Search by Name</label>
                            <input type="text" id="searchName" placeholder="Enter instructor name..." style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;" onkeyup="filterInstructors()">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Filter by Department</label>
                            <select id="filterDepartment" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;" onchange="filterInstructors()">
                                <option value="">All Departments</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Information Technology">Information Technology</option>
                                <option value="Mathematics">Mathematics</option>
                                <option value="English">English</option>
                                <option value="Science">Science</option>
                                <option value="Business">Business</option>
                                <option value="Engineering">Engineering</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #374151;">Filter by Status</label>
                            <select id="filterStatus" style="width: 100%; padding: 8px; border: 1px solid #d1d5db; border-radius: 5px;" onchange="filterInstructors()">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Instructor Table -->
                <div style="overflow-x: auto;">
                    <table id="instructorsTable" style="width: 100%; border-collapse: collapse; background: white;">
                        <thead>
                            <tr style="background: #f3f4f6;">
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; cursor: pointer;" onclick="sortTable('id')">ID</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; cursor: pointer;" onclick="sortTable('name')">Name</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; cursor: pointer;" onclick="sortTable('department')">Department</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; cursor: pointer;" onclick="sortTable('status')">Status</th>
                                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; cursor: pointer;" onclick="sortTable('created_at')">Date Added</th>
                                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="instructorsTableBody">
                            <!-- Instructor data will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Loading indicator -->
                <div id="instructorsLoading" style="text-align: center; padding: 20px; display: none;">
                    <p>Loading instructors...</p>
                </div>

                <!-- No data message -->
                <div id="noInstructors" style="text-align: center; padding: 40px; display: none;">
                    <p style="color: #6b7280;">No instructors found matching the current filters.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructor Details Modal -->
    <div id="instructorDetailsModal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 90%; max-width: 800px;">
            <div class="modal-header">
                <h3 id="detailsModalTitle">üë®‚Äçüè´ Instructor Details</h3>
                <span class="close" onclick="closeInstructorDetailsModal()">&times;</span>
            </div>
            <div class="modal-body" id="instructorDetailsContent">
                <!-- Instructor details will be populated here -->
                <div style="text-align: center; padding: 20px;">
                    <p>Loading instructor details...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal for Actions -->
    <div id="confirmationModal" class="modal" style="display: none;">
        <div class="modal-content" style="width: 90%; max-width: 500px;">
            <div class="modal-header">
                <h3 id="confirmationTitle">‚ö†Ô∏è Confirm Action</h3>
                <span class="close" onclick="closeConfirmationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to perform this action?</p>
                <div style="margin-top: 20px; text-align: right;">
                    <button onclick="closeConfirmationModal()" style="background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin-right: 10px;">Cancel</button>
                    <button id="confirmActionBtn" onclick="executeConfirmedAction()" style="background: #dc2626; color: white; padding: 10px 20px; border: none; border-radius: 5px;">Confirm</button>
                </div>
            </div>
        </div>
    </div>


</body>

</html>
